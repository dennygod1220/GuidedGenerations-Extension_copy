// ComfyUI å ´æ™¯é¢¨æ ¼ç”Ÿåœ–è…³æœ¬
// é©ç”¨æ–¼å ´æ™¯/é¢¨æ ¼åƒè€ƒåœ–,åƒç…§ç’°å¢ƒæ°›åœå’Œè—è¡“é¢¨æ ¼

// å®šç¾©æç¤ºè©å‰ç¶´
/let prefix [You are an assistant enhancing the prompt.\nCreate an image with {{char}} and {{user}} in a scene inspired by the reference image's style, atmosphere, and environment.\n\nVisual Requirements:\n- Only {{user}} and {{char}} appear in the image, no other people\n- No text or watermarks in the image\n- Match the artistic style, color palette, and mood of the reference image\n- Incorporate the environmental elements and atmosphere from the reference\n- Maintain consistent lighting and ambiance throughout\n\nScene Requirements:\n- Use the reference image's setting as inspiration (indoor/outdoor, time of day, weather, etc.)\n- Incorporate similar environmental details (architecture, nature, objects, etc.)\n- Match the overall composition and framing style\n- Preserve the artistic technique and rendering style of the reference\n\nAnatomical Requirements:\n- Correct human anatomy: each person has exactly 2 arms, 2 legs, 1 head\n- Natural poses that fit the scene and style\n- Correct gender characteristics\n- No extra limbs, no missing body parts\n- Proper body proportions and joint positions\n\nCharacter Race: East Asian\n] |

// ç²å–ç•¶å‰ custom_auto_guide è®Šæ•¸å…§å®¹
/getvar key=custom_auto_guide |
/let current_prompt {{pipe}} |

// æª¢æŸ¥æ˜¯å¦ç‚ºç©º,å¦‚æœç‚ºç©ºå‰‡å…ˆç”Ÿæˆ
/if left={{var::current_prompt}} rule=empty else=":generate_image" |
    /echo ğŸ”„ Custom Auto Guide è®Šæ•¸ç‚ºç©ºï¼Œæ­£åœ¨ç”Ÿæˆ... |
    /run-persistent-guide customAuto |
    /delay 1000 |
    /getvar key=custom_auto_guide |
    /let current_prompt {{pipe}} |
:generate_image |

// æª¢æŸ¥æ˜¯å¦æˆåŠŸç²å–
/if left={{var::current_prompt}} rule=empty else=":call_comfyui" |
    /echo âŒ ç„¡æ³•ç”Ÿæˆ Custom Auto Guideï¼Œè«‹æª¢æŸ¥è¨­å®š |
    /abort |
:call_comfyui |

// çµ„åˆå®Œæ•´ prompt: å‰ç¶´ + Custom Auto Guide å…§å®¹
/let final_prompt {{var::prefix}}\n\n{{var::current_prompt}} |

// å‘¼å« ComfyUI
/echo ğŸ¨ æ­£åœ¨ä½¿ç”¨å ´æ™¯é¢¨æ ¼å‘¼å« ComfyUI... |
/sd extend=false {{var::final_prompt}} |
/echo âœ… ComfyUI è«‹æ±‚å·²ç™¼é€ï¼(å ´æ™¯é¢¨æ ¼) |
